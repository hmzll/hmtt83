"use strict";(self["webpackChunkhmtt83"]=self["webpackChunkhmtt83"]||[]).push([[350],{4350:function(t,n,a){a.r(n),a.d(n,{default:function(){return y}});var e=function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",[a("van-nav-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[a("div",{staticClass:"logo"})]},proxy:!0},{key:"right",fn:function(){return[a("van-button",{attrs:{round:"",icon:"search",type:"primary"},on:{click:function(n){return t.$router.push("/search")}}},[t._v("搜索")])]},proxy:!0}])}),a("van-tabs",{model:{value:t.tabIndex,callback:function(n){t.tabIndex=n},expression:"tabIndex"}},[t._l(t.ownChannels,(function(t){return a("van-tab",{key:t.id,attrs:{title:t.name}},[a("article-list",{attrs:{channel_id:t.id}})],1)})),a("div",{staticClass:"icon-box"},[a("van-icon",{attrs:{name:"wap-nav"},on:{click:function(n){t.showChannel=!0}}})],1)],2),a("van-action-sheet",{attrs:{title:"频道管理"},model:{value:t.showChannel,callback:function(n){t.showChannel=n},expression:"showChannel"}},[a("channel",{attrs:{ownList:t.ownChannels,allList:t.allChannels},on:{close:function(n){t.showChannel=!1}},model:{value:t.tabIndex,callback:function(n){t.tabIndex=n},expression:"tabIndex"}})],1)],1)},s=[],i=a(7214),l=function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",{ref:"artList",staticClass:"article-list",on:{scroll:t.onScroll}},[a("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.pullLoading,callback:function(n){t.pullLoading=n},expression:"pullLoading"}},[a("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(n){t.loading=n},expression:"loading"}},t._l(t.list,(function(n){return a("van-cell",{key:n.art_id,on:{click:function(a){return t.$router.push({name:"article",query:{id:n.art_id}})}}},[[a("div",[t._v(t._s(n.title))]),a("van-grid",{attrs:{border:!1,"column-num":n.cover.type}},t._l(n.cover.images,(function(t,n){return a("van-grid-item",{key:n},[a("van-image",{attrs:{src:t}})],1)})),1),a("div",{staticClass:"info"},[a("span",[t._v(t._s(n.aut_name))]),a("span",[t._v(t._s(n.comm_count)+"评论")]),a("span",[t._v(t._s(t._f("relvTime")(n.pubdate)))]),a("van-icon",{attrs:{name:"cross"}})],1)]],2)})),1)],1)],1)},o=[],r={props:{channel_id:{required:!0}},data(){return{list:[],pullLoading:!1,loading:!1,finished:!1,timestamp:Date.now(),scrollTop:0}},methods:{onScroll(){this.scrollTop=this.$refs.artList.scrollTop},async onLoad(){let t=await(0,i.P8)({channel_id:this.channel_id,timestamp:this.timestamp});this.list.push(...t.data.data.results),this.timestamp=t.data.data.pre_timestamp,this.loading=!1,null==t.data.data.pre_timestamp&&(this.finished=!0)},async onRefresh(){let t=await(0,i.P8)({channel_id:this.channel_id,timestamp:Date.now()});this.list=t.data.data.results,this.timestamp=t.data.data.pre_timestamp,this.pullLoading=!1}},activated(){this.$refs.artList.scrollTop=this.scrollTop}},c=r,d=a(1001),h=(0,d.Z)(c,l,o,!1,null,"d3b86b82",null),u=h.exports,p=function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",[a("div",{staticClass:"my-box"},[a("div",{staticClass:"title"},[a("span",[t._v("我的频道")]),a("van-button",{staticStyle:{float:"right"},attrs:{plain:"",type:"danger",size:"small"},on:{click:function(n){t.isShow=!t.isShow}}},[t._v(t._s(t.isShow?"取消":"编辑"))])],1),a("van-grid",t._l(t.ownList,(function(n,e){return a("van-grid-item",{key:n.id},[a("span",{staticClass:"sp",class:{active:e==t.value},on:{click:function(n){return t.onSpanClick(e)}}},[t._v(t._s(n.name))]),a("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isShow&&0!=e,expression:"isShow && index != 0"}],attrs:{name:"cross"},on:{click:function(n){return t.del(e)}}})],1)})),1)],1),a("div",{staticClass:"my-box"},[t._m(0),a("van-grid",t._l(t.optionalList,(function(n){return a("van-grid-item",{key:n.id,attrs:{text:n.name},on:{click:function(a){return t.ownList.push(n)}}})})),1)],1)])},m=[function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticClass:"title"},[a("span",[t._v("可选频道")])])}],v={props:{ownList:{type:Array,required:!0},allList:{type:Array,required:!0},value:{type:Number,required:!0}},data(){return{isShow:!1}},methods:{del(t){this.ownList.splice(t,1),t<this.value&&this.$emit("input",this.value-1)},onSpanClick(t){this.$emit("input",t),this.$emit("close")}},computed:{optionalList(){return this.allList.filter((t=>-1==this.ownList.findIndex((n=>n.id==t.id))))}}},f=v,_=(0,d.Z)(f,p,m,!1,null,"6419a3b3",null),w=_.exports,C={name:"home",components:{articleList:u,channel:w},data(){return{ownChannels:[],allChannels:[],showChannel:!1,tabIndex:0,LOCAL_KEY:"channels"}},async created(){const t=JSON.parse(window.localStorage.getItem(this.LOCAL_KEY));if(this.$store.state.tokenObj.token||!t){let t=await(0,i.pZ)();this.ownChannels=t.data.data.channels}else this.ownChannels=t;let n=await(0,i.xi)();this.allChannels=n.data.data.channels},watch:{async ownChannels(){if(this.showChannel)if(this.$store.state.tokenObj.token){const t=this.ownChannels.map(((t,n)=>({id:t.id,seq:n+1})));await(0,i.As)({channels:t})}else window.localStorage.setItem(this.LOCAL_KEY,JSON.stringify(this.ownChannels))}},destroyed(){console.log("home销毁了")}},b=C,k=(0,d.Z)(b,e,s,!1,null,"46de578a",null),y=k.exports}}]);